import{j as t}from"./jsx-runtime.o45eZTEF.js";import{r as x}from"./index.DVhKKaGN.js";function U({actors:g,basePath:M}){const w=x.useRef(null),_=x.useRef(null),[f,L]=x.useState({width:800,height:600}),[v,k]=x.useState([]),[b,$]=x.useState([]),[N,A]=x.useState(null),[I,F]=x.useState(null),[E,R]=x.useState(!0),j=x.useRef(),T=e=>{if(e.type==="organisation")return"#6366f1";if(e.type==="finding")return"#d4af37";switch(e.classification){case"DEFENDANT":return"#ef4444";case"WITNESS_FAVOURABLE":case"CURRENT_CARE":return"#22c55e";case"WITNESS_ADVERSE":return"#f59e0b";default:return"#64748b"}};x.useEffect(()=>{const e=f.width/2,i=f.height/2,c=g.map((n,a)=>{const l=a/g.length*2*Math.PI,d=150+Math.random()*100;return{id:n.id,type:"actor",label:n.name,classification:n.classification,critical:n.critical,x:e+Math.cos(l)*d,y:i+Math.sin(l)*d,vx:0,vy:0,radius:n.critical?30:24}}),o=[...new Set(g.map(n=>n.organisation))],p=o.map((n,a)=>{const l=a/o.length*2*Math.PI;return{id:`org-${n}`,type:"organisation",label:n.length>25?n.substring(0,22)+"...":n,x:e+Math.cos(l)*50,y:i+Math.sin(l)*50,vx:0,vy:0,radius:20}}),y=g.map(n=>({source:n.id,target:`org-${n.organisation}`,type:"works_at"})),s=new Map;g.forEach(n=>{n.relatedFindings?.forEach(a=>{s.set(a,(s.get(a)||0)+1)})});const r=[...s.entries()].filter(([n,a])=>a>=2).slice(0,15).map(([n])=>n),h=r.map((n,a)=>{const l=a/r.length*2*Math.PI+Math.PI/4,d=280+Math.random()*40;return{id:n,type:"finding",label:n,x:e+Math.cos(l)*d,y:i+Math.sin(l)*d,vx:0,vy:0,radius:16}}),u=[];g.forEach(n=>{n.relatedFindings?.forEach(a=>{r.includes(a)&&u.push({source:n.id,target:a,type:"related_finding"})})}),k([...c,...p,...h]),$([...y,...u])},[g,f]),x.useEffect(()=>{if(!E||v.length===0)return;const e=()=>{k(c=>{const o=c.map(s=>({...s})),p=f.width/2,y=f.height/2;return o.forEach((s,r)=>{const h=p-s.x,u=y-s.y;s.vx+=h*.001,s.vy+=u*.001,o.forEach((n,a)=>{if(r!==a){const l=s.x-n.x,d=s.y-n.y,S=Math.sqrt(l*l+d*d)||1,C=s.radius+n.radius+30;if(S<C){const D=(C-S)/S*.5;s.vx+=l*D,s.vy+=d*D}}})}),b.forEach(s=>{const r=o.find(u=>u.id===s.source),h=o.find(u=>u.id===s.target);if(r&&h){const u=h.x-r.x,n=h.y-r.y,a=Math.sqrt(u*u+n*n)||1,l=s.type==="works_at"?100:150,d=(a-l)*.01;r.vx+=u/a*d,r.vy+=n/a*d,h.vx-=u/a*d,h.vy-=n/a*d}}),o.forEach(s=>{s.vx*=.9,s.vy*=.9,s.x+=s.vx,s.y+=s.vy;const r=s.radius+10;s.x=Math.max(r,Math.min(f.width-r,s.x)),s.y=Math.max(r,Math.min(f.height-r,s.y))}),o}),j.current=requestAnimationFrame(e)};j.current=requestAnimationFrame(e);const i=setTimeout(()=>{R(!1)},5e3);return()=>{j.current&&cancelAnimationFrame(j.current),clearTimeout(i)}},[E,v.length,b,f]),x.useEffect(()=>{const e=()=>{if(w.current){const i=w.current.getBoundingClientRect();L({width:i.width,height:Math.min(i.width*.75,600)})}};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]);const z=x.useCallback(e=>{const i=new Set;return b.forEach(c=>{c.source===e&&i.add(c.target),c.target===e&&i.add(c.source)}),i},[b]),m=N||I,W=m?z(m):new Set,O=e=>{e.type==="actor"?A(N===e.id?null:e.id):e.type==="finding"&&(window.location.href=`${M}/findings/${e.id.toLowerCase()}`)};return t.jsxs("div",{ref:w,className:"relative w-full rounded-2xl bg-navy-800/30 border border-navy-700/50 overflow-hidden",children:[t.jsxs("div",{className:"absolute top-4 left-4 z-10 flex flex-wrap gap-3 text-xs",children:[t.jsxs("div",{className:"flex items-center gap-1.5 px-2 py-1 rounded bg-navy-900/80 backdrop-blur",children:[t.jsx("span",{className:"w-3 h-3 rounded-full bg-red-500"}),t.jsx("span",{className:"text-navy-300",children:"Defendant"})]}),t.jsxs("div",{className:"flex items-center gap-1.5 px-2 py-1 rounded bg-navy-900/80 backdrop-blur",children:[t.jsx("span",{className:"w-3 h-3 rounded-full bg-green-500"}),t.jsx("span",{className:"text-navy-300",children:"Favourable"})]}),t.jsxs("div",{className:"flex items-center gap-1.5 px-2 py-1 rounded bg-navy-900/80 backdrop-blur",children:[t.jsx("span",{className:"w-3 h-3 rounded-full bg-indigo-500"}),t.jsx("span",{className:"text-navy-300",children:"Organisation"})]}),t.jsxs("div",{className:"flex items-center gap-1.5 px-2 py-1 rounded bg-navy-900/80 backdrop-blur",children:[t.jsx("span",{className:"w-3 h-3 rounded-full bg-[#d4af37]"}),t.jsx("span",{className:"text-navy-300",children:"Finding"})]})]}),t.jsxs("div",{className:"absolute top-4 right-4 z-10 flex gap-2",children:[t.jsx("button",{onClick:()=>R(!0),className:"px-3 py-1.5 text-xs font-medium text-navy-300 bg-navy-900/80 backdrop-blur rounded-lg hover:bg-navy-800 transition-colors",children:E?"Simulating...":"Restart"}),N&&t.jsx("button",{onClick:()=>A(null),className:"px-3 py-1.5 text-xs font-medium text-gold-400 bg-navy-900/80 backdrop-blur rounded-lg hover:bg-navy-800 transition-colors",children:"Clear Selection"})]}),t.jsxs("svg",{ref:_,width:f.width,height:f.height,className:"cursor-move",children:[t.jsx("g",{className:"links",children:b.map((e,i)=>{const c=v.find(s=>s.id===e.source),o=v.find(s=>s.id===e.target);if(!c||!o)return null;const p=m&&(e.source===m||e.target===m),y=m?p?.8:.1:.3;return t.jsx("line",{x1:c.x,y1:c.y,x2:o.x,y2:o.y,stroke:e.type==="works_at"?"#6366f1":"#d4af37",strokeWidth:p?2:1,strokeOpacity:y,strokeDasharray:e.type==="related_finding"?"4,4":void 0},`link-${i}`)})}),t.jsx("g",{className:"nodes",children:v.map(e=>{const i=e.id===m,c=W.has(e.id),o=m?i||c?1:.3:1,p=i?1.2:1;return t.jsxs("g",{transform:`translate(${e.x}, ${e.y})`,style:{opacity:o,transition:"opacity 0.3s",cursor:"pointer"},onClick:()=>O(e),onMouseEnter:()=>F(e.id),onMouseLeave:()=>F(null),children:[e.critical&&t.jsx("circle",{r:e.radius+8,fill:"none",stroke:"#d4af37",strokeWidth:2,strokeOpacity:.4,className:"animate-pulse"}),t.jsx("circle",{r:e.radius*p,fill:T(e),stroke:i?"#d4af37":"#1a2744",strokeWidth:i?3:2,style:{transition:"r 0.3s, stroke 0.3s"}}),t.jsx("text",{textAnchor:"middle",dy:e.radius+14,fill:"#c8d4e8",fontSize:10,fontFamily:"Inter, sans-serif",style:{pointerEvents:"none",opacity:i||c?1:.7},children:e.label.length>15?e.label.substring(0,12)+"...":e.label}),e.type==="organisation"&&t.jsx("text",{textAnchor:"middle",dy:4,fill:"white",fontSize:12,style:{pointerEvents:"none"},children:"ðŸ¥"}),e.type==="finding"&&t.jsx("text",{textAnchor:"middle",dy:4,fill:"#0a0f1a",fontSize:9,fontWeight:"bold",fontFamily:"JetBrains Mono, monospace",style:{pointerEvents:"none"},children:e.label}),e.type==="actor"&&t.jsx("text",{textAnchor:"middle",dy:4,fill:"white",fontSize:11,fontWeight:"600",fontFamily:"Inter, sans-serif",style:{pointerEvents:"none"},children:e.label.split(" ").map(y=>y[0]).join("").substring(0,2)})]},e.id)})})]}),N&&t.jsx("div",{className:"absolute bottom-4 left-4 right-4 p-4 bg-navy-900/95 backdrop-blur-xl rounded-xl border border-navy-700/50",children:(()=>{const e=g.find(i=>i.id===N);return e?t.jsxs("div",{className:"flex items-start gap-4",children:[t.jsx("div",{className:`w-12 h-12 rounded-xl flex items-center justify-center ${e.classification==="DEFENDANT"?"bg-red-500/20 text-red-400":e.classification==="WITNESS_FAVOURABLE"||e.classification==="CURRENT_CARE"?"bg-green-500/20 text-green-400":"bg-slate-500/20 text-slate-400"}`,children:t.jsx("span",{className:"text-lg font-semibold",children:e.name.split(" ").map(i=>i[0]).join("").substring(0,2)})}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("h4",{className:"text-white font-semibold",children:e.name}),t.jsx("p",{className:"text-sm text-navy-400",children:e.role}),t.jsx("p",{className:"text-xs text-navy-500 mt-1",children:e.organisation}),e.relatedFindings&&t.jsx("div",{className:"flex flex-wrap gap-1 mt-2",children:e.relatedFindings.slice(0,6).map(i=>t.jsx("a",{href:`${M}/findings/${i.toLowerCase()}`,className:"text-xs font-mono px-1.5 py-0.5 rounded bg-gold-500/20 text-gold-400 hover:bg-gold-500/30 transition-colors",children:i},i))})]})]}):null})()})]})}export{U as default};
