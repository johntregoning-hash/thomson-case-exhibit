---
import Badge from '@components/common/Badge.astro';

interface Props {
  finding: {
    id: string;
    title: string;
    category: string;
    summary: string;
    evidenceStatus: string;
    legalSignificance?: string;
  };
  expanded?: boolean;
}

const { finding, expanded = false } = Astro.props;

const categoryMap: Record<string, any> = {
  'VINDICATION': 'vindication',
  'BREACH': 'breach',
  'DISCREPANCY': 'discrepancy',
  'CAUSATION': 'causation',
  'QUANTUM': 'quantum',
  'PROCEDURAL': 'procedural',
  'STRATEGIC': 'strategic',
  'WITNESS': 'witness',
  'FABRICATION': 'fabrication',
  'NEUROLOGICAL': 'causation',
  'MEDICATION': 'breach',
  'FND/SOMATOFORM': 'breach'
};

const variant = categoryMap[finding.category] || 'default';

const statusColor = finding.evidenceStatus?.toLowerCase().includes('verified')
  ? 'text-vindication-500'
  : finding.evidenceStatus?.toLowerCase().includes('contradicted')
    ? 'text-breach-500'
    : 'text-navy-400';
---

<div class="card-interactive p-6 group" data-finding-id={finding.id} data-category={finding.category}>
  <div class="flex items-start justify-between mb-4">
    <div class="flex items-center gap-3">
      <span class="text-sm font-mono text-navy-500 group-hover:text-gold-500 transition-colors">{finding.id}</span>
      <Badge variant={variant}>{finding.category}</Badge>
    </div>
    {finding.evidenceStatus && (
      <span class:list={['text-xs font-medium', statusColor]}>
        {finding.evidenceStatus}
      </span>
    )}
  </div>

  <h3 class="text-lg font-serif font-semibold text-white mb-3 group-hover:text-gold-400 transition-colors">
    {finding.title}
  </h3>

  <p class="text-sm text-navy-300 leading-relaxed line-clamp-3">
    {finding.summary || 'No summary available'}
  </p>

  {expanded && finding.legalSignificance && (
    <div class="mt-4 pt-4 border-t border-navy-800">
      <h4 class="text-xs font-semibold text-gold-500 uppercase tracking-wider mb-2">Legal Significance</h4>
      <p class="text-sm text-navy-400 leading-relaxed">{finding.legalSignificance}</p>
    </div>
  )}

  <div class="mt-4 pt-4 border-t border-navy-800/50">
    <a
      href={`/findings/${finding.id.toLowerCase()}`}
      class="text-sm text-gold-500 hover:text-gold-400 transition-colors inline-flex items-center gap-2"
    >
      View Details
      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
      </svg>
    </a>
  </div>
</div>
