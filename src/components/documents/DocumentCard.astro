---
/**
 * DocumentCard Component - V2 Design
 *
 * Document listing card with:
 * - Tier badge (1-7) with color coding
 * - Document type icon
 * - Date and significance
 * - Quick preview on hover
 * - Glassmorphism styling
 */

interface Props {
  document: {
    name: string;
    date: string;
    significance: string;
    tier: number;
    type?: string;
  };
  compact?: boolean;
}

const { document, compact = false } = Astro.props;

// Tier styling
const tierStyles: Record<number, {
  bg: string;
  text: string;
  border: string;
  label: string;
}> = {
  1: {
    bg: 'bg-gold-500/20',
    text: 'text-gold-400',
    border: 'border-gold-500/30',
    label: 'Highest'
  },
  2: {
    bg: 'bg-green-500/20',
    text: 'text-green-400',
    border: 'border-green-500/30',
    label: 'High'
  },
  3: {
    bg: 'bg-purple-500/20',
    text: 'text-purple-400',
    border: 'border-purple-500/30',
    label: 'High'
  },
  4: {
    bg: 'bg-blue-500/20',
    text: 'text-blue-400',
    border: 'border-blue-500/30',
    label: 'Med-High'
  },
  5: {
    bg: 'bg-cyan-500/20',
    text: 'text-cyan-400',
    border: 'border-cyan-500/30',
    label: 'Medium'
  },
  6: {
    bg: 'bg-amber-500/20',
    text: 'text-amber-400',
    border: 'border-amber-500/30',
    label: 'Medium'
  },
  7: {
    bg: 'bg-red-500/20',
    text: 'text-red-400',
    border: 'border-red-500/30',
    label: 'Lowest'
  }
};

const style = tierStyles[document.tier] || tierStyles[7];

// Check if significance contains contradiction markers
const isContradicted = document.significance.includes('CONTRADICTED');
const isDisputed = document.significance.includes('DISPUTED');
---

<article class="document-card group relative">
  <div class:list={[
    'relative overflow-hidden rounded-xl border backdrop-blur-xl transition-all duration-300',
    'bg-navy-800/40 hover:bg-navy-800/60',
    'border-navy-700/50 hover:border-navy-600/50',
    'hover:shadow-lg',
    compact ? 'p-3' : 'p-4'
  ]}>
    <div class="flex items-start gap-4">
      <!-- Tier Badge -->
      <div class:list={[
        'flex-shrink-0 w-10 h-10 rounded-lg flex items-center justify-center font-display font-bold border',
        style.bg,
        style.text,
        style.border
      ]}>
        {document.tier}
      </div>

      <!-- Content -->
      <div class="flex-1 min-w-0">
        <!-- Header Row -->
        <div class="flex items-start justify-between gap-2 mb-1">
          <h4 class:list={[
            'font-medium text-white group-hover:text-gold-400 transition-colors truncate',
            compact ? 'text-sm' : 'text-base'
          ]}>
            {document.name}
          </h4>
          <span class="text-xs text-navy-500 whitespace-nowrap flex-shrink-0">
            {document.date}
          </span>
        </div>

        <!-- Significance -->
        <p class:list={[
          'leading-relaxed',
          compact ? 'text-xs text-navy-400 line-clamp-1' : 'text-sm text-navy-300 line-clamp-2',
          isContradicted ? 'text-red-400/80' : '',
          isDisputed ? 'text-amber-400/80' : ''
        ]}>
          {document.significance}
        </p>

        <!-- Tier Label (on hover) -->
        {!compact && (
          <div class="mt-2 opacity-0 group-hover:opacity-100 transition-opacity">
            <span class:list={[
              'text-xs px-2 py-0.5 rounded',
              style.bg,
              style.text
            ]}>
              Tier {document.tier} - {style.label} Reliability
            </span>
          </div>
        )}
      </div>

      <!-- Status Indicator for contradicted items -->
      {isContradicted && (
        <div class="flex-shrink-0">
          <div class="w-2 h-2 rounded-full bg-red-500 animate-pulse"></div>
        </div>
      )}
    </div>
  </div>
</article>

<style>
  .document-card {
    opacity: 0;
    animation: card-appear 0.3s ease-out forwards;
  }

  @keyframes card-appear {
    from {
      opacity: 0;
      transform: translateX(-10px);
    }
    to {
      opacity: 1;
      transform: translateX(0);
    }
  }

  .line-clamp-1 {
    display: -webkit-box;
    -webkit-line-clamp: 1;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  .line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
</style>
