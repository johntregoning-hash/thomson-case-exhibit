---
/**
 * EvidenceTierCard Component - V2 Design
 *
 * Detailed card for each evidence tier with:
 * - Large tier number display
 * - Full description
 * - Example list with icons
 * - Reliability indicator
 * - Glassmorphism styling
 */

interface Props {
  tier: number;
  name: string;
  description: string;
  reliability: string;
  color: string;
  count: number | string;
  examples: string[];
  expanded?: boolean;
}

const { tier, name, description, reliability, color, count, examples, expanded = false } = Astro.props;

// Color mapping for variants
const colorStyles: Record<string, {
  tierBg: string;
  tierText: string;
  cardBg: string;
  cardBorder: string;
  accent: string;
  badgeBg: string;
  icon: string;
}> = {
  gold: {
    tierBg: 'bg-gradient-to-br from-gold-500 via-amber-500 to-gold-600',
    tierText: 'text-navy-900',
    cardBg: 'bg-gradient-to-br from-gold-500/5 via-navy-800/50 to-navy-800/50',
    cardBorder: 'border-gold-500/30 hover:border-gold-500/50',
    accent: 'text-gold-400',
    badgeBg: 'bg-gold-500/20 text-gold-400',
    icon: 'text-gold-500'
  },
  vindication: {
    tierBg: 'bg-gradient-to-br from-green-500 via-emerald-500 to-green-600',
    tierText: 'text-white',
    cardBg: 'bg-gradient-to-br from-green-500/5 via-navy-800/50 to-navy-800/50',
    cardBorder: 'border-green-500/30 hover:border-green-500/50',
    accent: 'text-green-400',
    badgeBg: 'bg-green-500/20 text-green-400',
    icon: 'text-green-500'
  },
  causation: {
    tierBg: 'bg-gradient-to-br from-purple-500 via-violet-500 to-purple-600',
    tierText: 'text-white',
    cardBg: 'bg-gradient-to-br from-purple-500/5 via-navy-800/50 to-navy-800/50',
    cardBorder: 'border-purple-500/30 hover:border-purple-500/50',
    accent: 'text-purple-400',
    badgeBg: 'bg-purple-500/20 text-purple-400',
    icon: 'text-purple-500'
  },
  breach: {
    tierBg: 'bg-gradient-to-br from-red-500 via-rose-500 to-red-600',
    tierText: 'text-white',
    cardBg: 'bg-gradient-to-br from-red-500/5 via-navy-800/50 to-navy-800/50',
    cardBorder: 'border-red-500/30 hover:border-red-500/50',
    accent: 'text-red-400',
    badgeBg: 'bg-red-500/20 text-red-400',
    icon: 'text-red-500'
  },
  default: {
    tierBg: 'bg-gradient-to-br from-navy-600 via-navy-700 to-navy-600',
    tierText: 'text-white',
    cardBg: 'bg-navy-800/50',
    cardBorder: 'border-navy-700/50 hover:border-navy-600/50',
    accent: 'text-navy-300',
    badgeBg: 'bg-navy-700/50 text-navy-300',
    icon: 'text-navy-400'
  }
};

const style = colorStyles[color] || colorStyles.default;

// Reliability badge styles
const reliabilityStyles: Record<string, string> = {
  'HIGHEST': 'bg-gold-500/20 text-gold-400 border-gold-500/30',
  'HIGH': 'bg-green-500/20 text-green-400 border-green-500/30',
  'MEDIUM-HIGH': 'bg-blue-500/20 text-blue-400 border-blue-500/30',
  'MEDIUM': 'bg-amber-500/20 text-amber-400 border-amber-500/30',
  'LOWEST': 'bg-red-500/20 text-red-400 border-red-500/30'
};

const reliabilityStyle = reliabilityStyles[reliability] || reliabilityStyles['MEDIUM'];
---

<article
  class="evidence-tier-card group"
  data-tier={tier}
  data-color={color}
>
  <div class:list={[
    'relative overflow-hidden rounded-2xl border backdrop-blur-xl transition-all duration-300',
    'hover:shadow-xl hover:shadow-navy-900/50',
    style.cardBg,
    style.cardBorder
  ]}>
    <!-- Tier Badge (positioned left) -->
    <div class="absolute -left-2 top-6 z-10">
      <div class:list={[
        'w-16 h-16 rounded-xl flex items-center justify-center font-display font-bold text-3xl shadow-lg',
        style.tierBg,
        style.tierText
      ]}>
        {tier}
      </div>
    </div>

    <!-- Main Content -->
    <div class="pl-20 pr-6 py-6">
      <!-- Header -->
      <div class="flex items-start justify-between gap-4 mb-4">
        <div>
          <h3 class="text-xl font-display font-semibold text-white mb-1">
            {name}
          </h3>
          <p class="text-sm text-navy-400">
            {description}
          </p>
        </div>

        <!-- Stats -->
        <div class="flex flex-col items-end gap-2">
          <span class:list={[
            'px-3 py-1 rounded-lg text-xs font-semibold border',
            reliabilityStyle
          ]}>
            {reliability}
          </span>
          <span class:list={[
            'px-3 py-1.5 rounded-lg font-mono font-bold',
            style.badgeBg
          ]}>
            {count} items
          </span>
        </div>
      </div>

      <!-- Examples Section -->
      <div class="mt-6">
        <h4 class="text-xs font-semibold text-navy-500 uppercase tracking-wider mb-3 flex items-center gap-2">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
          </svg>
          Key Examples
        </h4>
        <ul class="grid grid-cols-1 sm:grid-cols-2 gap-3">
          {examples.map((example, index) => (
            <li
              class="flex items-start gap-3 text-sm example-item"
              style={`animation-delay: ${index * 50}ms`}
            >
              <div class:list={[
                'flex-shrink-0 w-5 h-5 rounded-full flex items-center justify-center mt-0.5',
                style.badgeBg
              ]}>
                <svg class:list={['w-3 h-3', style.icon]} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                </svg>
              </div>
              <span class="text-navy-300 leading-relaxed">
                {example}
              </span>
            </li>
          ))}
        </ul>
      </div>

      <!-- Decorative Corner Element -->
      <div class:list={[
        'absolute top-0 right-0 w-32 h-32 opacity-20 pointer-events-none',
        style.icon
      ]}>
        <svg viewBox="0 0 100 100" fill="currentColor">
          <polygon points="100,0 100,100 0,0" />
        </svg>
      </div>
    </div>
  </div>
</article>

<style>
  .evidence-tier-card {
    opacity: 0;
    animation: card-slide-in 0.5s ease-out forwards;
  }

  @keyframes card-slide-in {
    from {
      opacity: 0;
      transform: translateX(-20px);
    }
    to {
      opacity: 1;
      transform: translateX(0);
    }
  }

  .example-item {
    opacity: 0;
    animation: item-fade-in 0.3s ease-out forwards;
  }

  @keyframes item-fade-in {
    from {
      opacity: 0;
      transform: translateY(10px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  /* Pause animations until in view */
  .evidence-tier-card:not(.in-view) {
    animation-play-state: paused;
  }

  .evidence-tier-card:not(.in-view) .example-item {
    animation-play-state: paused;
  }
</style>

<script>
  // Intersection Observer for scroll animations
  document.addEventListener('DOMContentLoaded', () => {
    const cards = document.querySelectorAll('.evidence-tier-card');

    const observer = new IntersectionObserver(
      (entries) => {
        entries.forEach((entry) => {
          if (entry.isIntersecting) {
            entry.target.classList.add('in-view');
          }
        });
      },
      { threshold: 0.1 }
    );

    cards.forEach((card) => observer.observe(card));
  });
</script>
