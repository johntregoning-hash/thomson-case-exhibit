---
/**
 * VindicationQuote Component - V2 Design
 *
 * Elegant quote card for vindication evidence with:
 * - Large quotation marks styling
 * - Specialist attribution
 * - Organisation badge
 * - Evidence tier indicator
 * - Glassmorphism card design
 */

import Badge from '@components/common/Badge.astro';

interface Props {
  quote: string;
  specialist: string;
  organisation: string;
  date: string;
  findingId: string;
  title: string;
  tier: 'Imaging' | 'Clinical' | 'Testimony';
  featured?: boolean;
  summary?: string;
}

const { quote, specialist, organisation, date, findingId, title, tier, featured = false, summary } = Astro.props;

const base = import.meta.env.BASE_URL;
const getHref = (path: string) => path === '/' ? (base || '/') : `${base}${path}`;

// Tier styling
const tierStyles: Record<string, { bg: string; text: string; icon: string }> = {
  'Imaging': {
    bg: 'bg-blue-500/20',
    text: 'text-blue-400',
    icon: 'M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z'
  },
  'Clinical': {
    bg: 'bg-green-500/20',
    text: 'text-green-400',
    icon: 'M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z'
  },
  'Testimony': {
    bg: 'bg-purple-500/20',
    text: 'text-purple-400',
    icon: 'M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z'
  }
};

const tierStyle = tierStyles[tier] || tierStyles['Clinical'];
---

<article
  class:list={[
    'vindication-quote group relative',
    featured ? 'featured' : ''
  ]}
  data-finding-id={findingId}
>
  <div class:list={[
    'relative overflow-hidden rounded-2xl transition-all duration-500',
    'bg-gradient-to-br from-green-500/5 via-navy-800/50 to-navy-800/50',
    'backdrop-blur-xl border border-green-500/20',
    'hover:border-green-500/40 hover:shadow-lg hover:shadow-green-500/10',
    featured ? 'p-8' : 'p-6'
  ]}>
    <!-- Decorative quote mark -->
    <div class="absolute -top-4 -left-2 text-green-500/10 pointer-events-none select-none">
      <svg class:list={['fill-current', featured ? 'w-24 h-24' : 'w-16 h-16']} viewBox="0 0 24 24">
        <path d="M14.017 21v-7.391c0-5.704 3.731-9.57 8.983-10.609l.995 2.151c-2.432.917-3.995 3.638-3.995 5.849h4v10h-9.983zm-14.017 0v-7.391c0-5.704 3.748-9.57 9-10.609l.996 2.151c-2.433.917-3.996 3.638-3.996 5.849h3.983v10h-9.983z" />
      </svg>
    </div>

    <!-- Featured badge -->
    {featured && (
      <div class="absolute top-4 right-4">
        <span class="inline-flex items-center gap-1.5 px-2 py-1 rounded-full bg-gold-500/20 text-gold-400 text-xs font-semibold">
          <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20">
            <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
          </svg>
          KEY
        </span>
      </div>
    )}

    <!-- Header -->
    <div class="flex items-start gap-3 mb-4 relative z-10">
      <span class="text-sm font-mono text-green-500">{findingId}</span>
      <div class:list={[
        'flex items-center gap-1.5 px-2 py-0.5 rounded-full text-xs font-medium',
        tierStyle.bg,
        tierStyle.text
      ]}>
        <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d={tierStyle.icon} />
        </svg>
        {tier}
      </div>
    </div>

    <!-- Title -->
    <h3 class:list={[
      'font-display font-semibold text-white mb-4 group-hover:text-green-400 transition-colors',
      featured ? 'text-xl' : 'text-lg'
    ]}>
      {title}
    </h3>

    <!-- Quote -->
    <blockquote class:list={[
      'relative z-10 font-serif italic text-green-400 mb-4',
      'border-l-3 border-green-500/50 pl-4',
      featured ? 'text-xl leading-relaxed' : 'text-lg'
    ]}>
      {quote}
    </blockquote>

    <!-- Summary (if provided) -->
    {summary && (
      <p class="text-sm text-navy-300 mb-4 leading-relaxed">
        {summary}
      </p>
    )}

    <!-- Attribution -->
    <div class="relative z-10 flex items-center gap-4 pt-4 border-t border-green-500/20">
      <!-- Specialist Avatar -->
      <div class="w-10 h-10 rounded-full bg-green-500/20 flex items-center justify-center">
        <svg class="w-5 h-5 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
        </svg>
      </div>

      <div class="flex-1 min-w-0">
        <p class="text-sm font-medium text-white truncate">{specialist}</p>
        <p class="text-xs text-navy-400 truncate">{organisation}</p>
      </div>

      <div class="text-right">
        <p class="text-xs text-navy-500">{date}</p>
      </div>
    </div>

    <!-- View Finding Link -->
    <a
      href={getHref(`/findings/${findingId.toLowerCase()}`)}
      class="absolute inset-0 z-20"
      aria-label={`View finding ${findingId}`}
    >
      <span class="sr-only">View finding details</span>
    </a>

    <!-- Hover Arrow -->
    <div class="absolute bottom-6 right-6 opacity-0 group-hover:opacity-100 transition-opacity z-10 pointer-events-none">
      <svg class="w-5 h-5 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3" />
      </svg>
    </div>
  </div>
</article>

<style>
  .vindication-quote {
    transform: translateZ(0);
  }

  .vindication-quote.featured {
    grid-column: span 2;
  }

  @media (max-width: 768px) {
    .vindication-quote.featured {
      grid-column: span 1;
    }
  }

  .border-l-3 {
    border-left-width: 3px;
  }

  /* Staggered appearance animation */
  @keyframes quote-appear {
    from {
      opacity: 0;
      transform: translateY(30px) scale(0.98);
    }
    to {
      opacity: 1;
      transform: translateY(0) scale(1);
    }
  }

  .vindication-quote {
    animation: quote-appear 0.6s ease-out forwards;
  }
</style>
