---
import BaseLayout from '@layouts/BaseLayout.astro';
import Card from '@components/common/Card.astro';
import Badge from '@components/common/Badge.astro';

// Import actors data from JSON
import actorsData from '../data/actors.json';

// Get all actors
const allActors = actorsData.actors;
const organisationSummary = actorsData.organisationSummary;

// Classification helpers
const getClassificationColor = (classification: string) => {
  switch (classification) {
    case 'WITNESS_FAVOURABLE': return 'vindication';
    case 'CURRENT_CARE': return 'vindication';
    case 'DEFENDANT': return 'breach';
    case 'WITNESS_ADVERSE': return 'discrepancy';
    default: return 'default';
  }
};

const getClassificationLabel = (classification: string) => {
  switch (classification) {
    case 'WITNESS_FAVOURABLE': return 'Favourable Witness';
    case 'CURRENT_CARE': return 'Current Care';
    case 'DEFENDANT': return 'Potential Defendant';
    case 'WITNESS_ADVERSE': return 'Adverse Witness';
    case 'ADMINISTRATIVE': return 'Administrative';
    default: return classification;
  }
};

const getCategoryIcon = (classification: string) => {
  switch (classification) {
    case 'DEFENDANT':
      return '<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" /></svg>';
    case 'WITNESS_FAVOURABLE':
    case 'CURRENT_CARE':
      return '<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z" /></svg>';
    default:
      return '<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" /></svg>';
  }
};

// Separate actors by classification
const defendants = allActors.filter(a => a.classification === 'DEFENDANT');
const favourableWitnesses = allActors.filter(a => a.classification === 'WITNESS_FAVOURABLE' || a.classification === 'CURRENT_CARE');
const adverseWitnesses = allActors.filter(a => a.classification === 'WITNESS_ADVERSE');

// Count critical actors
const criticalActors = allActors.filter(a => a.critical);
---

<BaseLayout title="Actors" description="Key individuals involved in the Thomson clinical negligence case">
  <!-- Header -->
  <section class="py-16 bg-navy-900/30">
    <div class="container-wide">
      <div class="max-w-3xl">
        <h1 class="text-4xl font-serif font-bold text-white mb-4">Key Actors</h1>
        <p class="text-lg text-navy-300">
          Individuals documented in the case with their roles, organisations, and documented conduct.
          Each actor is linked to relevant findings with verified documentary evidence.
        </p>
      </div>
    </div>
  </section>

  <!-- Stats -->
  <section class="border-y border-navy-800/50 bg-navy-950">
    <div class="container-wide py-6">
      <div class="flex flex-wrap items-center gap-6">
        <div class="flex items-center gap-2">
          <span class="text-2xl font-bold text-white">{allActors.length}</span>
          <span class="text-sm text-navy-400">Key Actors</span>
        </div>
        <div class="w-px h-8 bg-navy-800 hidden sm:block"></div>
        <div class="flex items-center gap-2">
          <span class="text-2xl font-bold text-breach-400">{defendants.length}</span>
          <span class="text-sm text-navy-400">Potential Defendants</span>
        </div>
        <div class="w-px h-8 bg-navy-800 hidden sm:block"></div>
        <div class="flex items-center gap-2">
          <span class="text-2xl font-bold text-vindication-400">{favourableWitnesses.length}</span>
          <span class="text-sm text-navy-400">Favourable Witnesses</span>
        </div>
        <div class="w-px h-8 bg-navy-800 hidden sm:block"></div>
        <div class="flex items-center gap-2">
          <span class="text-2xl font-bold text-gold-400">{criticalActors.length}</span>
          <span class="text-sm text-navy-400">Critical</span>
        </div>
      </div>
    </div>
  </section>

  <!-- Potential Defendants -->
  <section class="py-16">
    <div class="container-wide">
      <h2 class="text-2xl font-serif font-bold text-white mb-6 flex items-center gap-3">
        <span class="w-3 h-3 rounded-full bg-breach-500"></span>
        Potential Defendants
      </h2>
      <p class="text-navy-400 mb-8">
        Healthcare professionals and staff whose documented actions form part of the negligence allegations.
        All conduct is verified by documentary evidence.
      </p>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        {defendants.map((actor) => (
          <Card variant="default" class="p-6 border-breach-500/20 hover:border-breach-500/40 transition-all">
            <div class="flex items-start gap-4">
              <div class="w-12 h-12 rounded-xl bg-breach-500/20 flex items-center justify-center text-breach-500 shrink-0">
                <Fragment set:html={getCategoryIcon(actor.classification)} />
              </div>
              <div class="flex-1 min-w-0">
                <div class="flex items-start justify-between gap-2">
                  <div>
                    <h3 class="font-semibold text-white">{actor.name}</h3>
                    <p class="text-sm text-navy-400">{actor.role}</p>
                    <p class="text-xs text-navy-500 truncate">{actor.organisation}</p>
                  </div>
                  <div class="flex flex-col items-end gap-1 shrink-0">
                    <Badge variant={getClassificationColor(actor.classification) as any}>
                      {getClassificationLabel(actor.classification)}
                    </Badge>
                    {actor.critical && (
                      <span class="text-xs font-semibold text-gold-500">CRITICAL</span>
                    )}
                  </div>
                </div>

                <p class="text-sm text-navy-300 mt-4 leading-relaxed line-clamp-3">
                  {actor.legalSignificance}
                </p>

                {actor.conduct && actor.conduct.length > 0 && (
                  <div class="mt-4 space-y-2">
                    <h4 class="text-xs font-semibold text-navy-500 uppercase tracking-wider">Key Conduct</h4>
                    <ul class="text-xs text-navy-400 space-y-1">
                      {actor.conduct.slice(0, 2).map((c: any) => (
                        <li class="flex items-start gap-2">
                          <span class={`w-1.5 h-1.5 rounded-full mt-1.5 shrink-0 ${
                            c.severity === 'critical' ? 'bg-breach-500' :
                            c.severity === 'high' ? 'bg-discrepancy-500' : 'bg-navy-600'
                          }`}></span>
                          <span class="line-clamp-2">{c.description}</span>
                        </li>
                      ))}
                    </ul>
                  </div>
                )}

                <div class="mt-4 pt-4 border-t border-navy-800/50 flex items-center justify-between">
                  <div class="flex flex-wrap gap-1">
                    {actor.relatedFindings && actor.relatedFindings.slice(0, 4).map((f: string) => (
                      <a href={`/findings/${f.toLowerCase()}`} class="text-xs font-mono text-gold-500 hover:text-gold-400">
                        {f}
                      </a>
                    ))}
                    {actor.relatedFindings && actor.relatedFindings.length > 4 && (
                      <span class="text-xs text-navy-500">+{actor.relatedFindings.length - 4}</span>
                    )}
                  </div>
                </div>
              </div>
            </div>
          </Card>
        ))}
      </div>
    </div>
  </section>

  <!-- Favourable Witnesses -->
  <section class="py-16 bg-navy-900/30">
    <div class="container-wide">
      <h2 class="text-2xl font-serif font-bold text-white mb-6 flex items-center gap-3">
        <span class="w-3 h-3 rounded-full bg-vindication-500"></span>
        Favourable Witnesses
      </h2>
      <p class="text-navy-400 mb-8">
        Healthcare professionals who documented objective findings, refuted psychiatric mischaracterisation,
        or advocated for appropriate care.
      </p>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        {favourableWitnesses.map((actor) => (
          <Card variant="default" class="p-6 border-vindication-500/20 hover:border-vindication-500/40 transition-all">
            <div class="flex items-start gap-4">
              <div class="w-12 h-12 rounded-xl bg-vindication-500/20 flex items-center justify-center text-vindication-500 shrink-0">
                <Fragment set:html={getCategoryIcon(actor.classification)} />
              </div>
              <div class="flex-1 min-w-0">
                <div class="flex items-start justify-between gap-2">
                  <div>
                    <h3 class="font-semibold text-white">{actor.name}</h3>
                    <p class="text-sm text-navy-400">{actor.role}</p>
                    <p class="text-xs text-navy-500 truncate">{actor.organisation}</p>
                  </div>
                  <div class="flex flex-col items-end gap-1 shrink-0">
                    <Badge variant={getClassificationColor(actor.classification) as any}>
                      {getClassificationLabel(actor.classification)}
                    </Badge>
                    {actor.critical && (
                      <span class="text-xs font-semibold text-gold-500">CRITICAL</span>
                    )}
                  </div>
                </div>

                <p class="text-sm text-navy-300 mt-4 leading-relaxed line-clamp-3">
                  {actor.legalSignificance}
                </p>

                {actor.conduct && actor.conduct.length > 0 && (
                  <div class="mt-4 space-y-2">
                    <h4 class="text-xs font-semibold text-navy-500 uppercase tracking-wider">Key Evidence</h4>
                    <ul class="text-xs text-navy-400 space-y-1">
                      {actor.conduct.slice(0, 2).map((c: any) => (
                        <li class="flex items-start gap-2">
                          <span class="w-1.5 h-1.5 rounded-full bg-vindication-500 mt-1.5 shrink-0"></span>
                          <span class="line-clamp-2">{c.description}</span>
                        </li>
                      ))}
                    </ul>
                  </div>
                )}

                <div class="mt-4 pt-4 border-t border-navy-800/50 flex items-center justify-between">
                  <div class="flex flex-wrap gap-1">
                    {actor.relatedFindings && actor.relatedFindings.slice(0, 4).map((f: string) => (
                      <a href={`/findings/${f.toLowerCase()}`} class="text-xs font-mono text-gold-500 hover:text-gold-400">
                        {f}
                      </a>
                    ))}
                    {actor.relatedFindings && actor.relatedFindings.length > 4 && (
                      <span class="text-xs text-navy-500">+{actor.relatedFindings.length - 4}</span>
                    )}
                  </div>
                  {actor.notes && (
                    <span class="text-xs text-gold-500 italic">See notes</span>
                  )}
                </div>
              </div>
            </div>
          </Card>
        ))}
      </div>
    </div>
  </section>

  <!-- Organisation Summary -->
  <section class="py-16">
    <div class="container-wide">
      <h2 class="text-2xl font-serif font-bold text-white mb-6">Organisation Summary</h2>
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        <Card variant="default" class="p-6 border-breach-500/20">
          <h3 class="font-semibold text-white mb-2">Former GP Practice</h3>
          <p class="text-xs text-navy-500 mb-4">{organisationSummary.groveParkTerraceSurgery.name}</p>
          <Badge variant="breach" class="mb-4">{organisationSummary.groveParkTerraceSurgery.status}</Badge>
          <p class="text-xs text-navy-400">
            <strong class="text-breach-400">{organisationSummary.groveParkTerraceSurgery.defendants.length}</strong> potential defendants
          </p>
          <p class="text-xs text-gold-500 mt-2 italic">{organisationSummary.groveParkTerraceSurgery.note}</p>
        </Card>

        <Card variant="default" class="p-6">
          <h3 class="font-semibold text-white mb-2">Imperial College Healthcare</h3>
          <p class="text-xs text-navy-500 mb-4">{organisationSummary.imperialCollegeHealthcare.name}</p>
          <Badge variant="default" class="mb-4">{organisationSummary.imperialCollegeHealthcare.status}</Badge>
          <div class="space-y-1 text-xs text-navy-400">
            <p><strong class="text-breach-400">{organisationSummary.imperialCollegeHealthcare.potentialDefendants?.length || 0}</strong> potential defendants</p>
            <p><strong class="text-vindication-400">{organisationSummary.imperialCollegeHealthcare.favourableWitnesses?.length || 0}</strong> favourable witnesses</p>
          </div>
        </Card>

        <Card variant="default" class="p-6 border-vindication-500/20">
          <h3 class="font-semibold text-white mb-2">Chelsea & Westminster</h3>
          <p class="text-xs text-navy-500 mb-4">{organisationSummary.chelseaWestminster.name}</p>
          <Badge variant="vindication" class="mb-4">{organisationSummary.chelseaWestminster.status}</Badge>
          <p class="text-xs text-navy-400">
            <strong class="text-vindication-400">{organisationSummary.chelseaWestminster.favourableWitnesses?.length || 0}</strong> favourable witnesses
          </p>
        </Card>

        <Card variant="default" class="p-6 border-vindication-500/20">
          <h3 class="font-semibold text-white mb-2">Current Practice</h3>
          <p class="text-xs text-navy-500 mb-4">{organisationSummary.currentPractice.name}</p>
          <Badge variant="vindication" class="mb-4">SUPPORTIVE</Badge>
          <p class="text-xs text-gold-500 italic">{organisationSummary.currentPractice.note}</p>
        </Card>
      </div>
    </div>
  </section>

  <!-- Classification Legend -->
  <section class="py-12 border-t border-navy-800/50 bg-navy-900/30">
    <div class="container-wide">
      <h2 class="text-lg font-serif font-bold text-white mb-4">Classification Key</h2>
      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
        <div class="flex items-center gap-3">
          <Badge variant="breach">DEFENDANT</Badge>
          <span class="text-sm text-navy-400">Potential defendant in negligence claim</span>
        </div>
        <div class="flex items-center gap-3">
          <Badge variant="vindication">FAVOURABLE WITNESS</Badge>
          <span class="text-sm text-navy-400">Evidence supports the claim</span>
        </div>
        <div class="flex items-center gap-3">
          <Badge variant="vindication">CURRENT CARE</Badge>
          <span class="text-sm text-navy-400">Currently involved in care</span>
        </div>
        <div class="flex items-center gap-3">
          <Badge variant="discrepancy">ADVERSE WITNESS</Badge>
          <span class="text-sm text-navy-400">Evidence may oppose the claim</span>
        </div>
      </div>
    </div>
  </section>
</BaseLayout>
