---
/**
 * Vindication Page - V2 Design
 *
 * The Defence Cannot Argue - Quote wall showcasing
 * independent specialist findings that vindicate the patient.
 *
 * Features:
 * - Dramatic hero with animated counters
 * - VindicationTimeline showing journey
 * - Quote wall with VindicationQuote cards
 * - Tier filtering (Imaging, Clinical, Testimony)
 * - Glassmorphism design throughout
 */

import BaseLayout from '@layouts/BaseLayout.astro';
import GlassCard from '@components/ui/GlassCard.astro';
import Badge from '@components/common/Badge.astro';
import VindicationQuote from '@components/vindication/VindicationQuote.astro';
import VindicationTimeline from '@components/vindication/VindicationTimeline.astro';
import AnimatedCounter from '@components/vindication/AnimatedCounter';

const base = import.meta.env.BASE_URL;
const getHref = (path: string) => path === '/' ? (base || '/') : `${base}${path}`;

// Vindication findings - the strongest evidence
const vindicationFindings = [
  {
    id: 'F030',
    title: 'Dr Gorrie Removes Somatoform Diagnosis',
    date: '22 July 2025',
    specialist: 'Dr Alexander Gorrie (GP)',
    organisation: 'Current Practice',
    quote: '"there were clear causes for his pain."',
    summary: 'Marked the Somatoform Pain Disorder diagnosis as INACTIVE. Highly unusual to remove without formal psychiatric reassessment - the error was self-evident.',
    legalSignificance: 'Subsequent NHS clinician independently determined original psychiatric diagnosis was inappropriate. This is internal vindication, not litigation-driven expert opinion.',
    tier: 'Clinical' as const,
    featured: true
  },
  {
    id: 'F031',
    title: 'Pain Clinic Refutes Somatoform',
    date: '2023',
    specialist: 'C&W Pain Clinic',
    organisation: 'Chelsea & Westminster Hospital',
    quote: '"GP prev told somatic, pain clinic at C&W; felt not somatic."',
    summary: 'Pain Clinic explicitly disagreed with somatoform characterisation.',
    legalSignificance: 'Independent specialist refutation of GP diagnosis. Supports argument that diagnosis had no valid clinical basis.',
    tier: 'Clinical' as const
  },
  {
    id: 'F038',
    title: 'Psychiatric Assessment Clearance',
    date: '2023',
    specialist: 'Dr Gupta',
    organisation: 'NHS Mental Health Services',
    quote: 'NO: PTSD, depression, psychosis, personality disorder, OR somatisation disorder',
    summary: 'Formal psychiatric assessment found no psychiatric disorders. Presentation consistent with inadequately treated physical illness.',
    legalSignificance: 'Formal psychiatric clearance undermines somatoform labelling. Independent assessment by qualified psychiatrist.',
    tier: 'Clinical' as const,
    featured: false
  },
  {
    id: 'F356',
    title: 'Vascular Surgeon Confirms Organic Diagnoses',
    date: '3 July 2024',
    specialist: 'Mr Aaron Goh',
    organisation: 'Royal Free Hospital',
    quote: 'Thoracic outlet syndrome (neurogenic), subclavian steal syndrome, vertebral artery compression',
    summary: 'Vascular surgeon formally lists multiple organic conditions including TOS, subclavian steal, and vertebral artery compression.',
    legalSignificance: 'Senior specialist confirming multiple organic diagnoses directly contradicts any functional/somatoform framing.',
    tier: 'Clinical' as const,
    featured: true
  },
  {
    id: 'F357',
    title: 'MRA Confirms Subclavian Compression & Stenosis',
    date: '3 July 2024',
    specialist: 'Mr Aaron Goh',
    organisation: 'Royal Free Hospital',
    quote: 'MRA... confirms compression and focal stenosis of subclavian arteries bilaterally',
    summary: 'MRA imaging confirms bilateral subclavian compression with focal stenosis - objective evidence of vascular pathology.',
    legalSignificance: 'High-tier imaging evidence confirming organic pathology. Cannot be dismissed as functional.',
    tier: 'Imaging' as const,
    featured: true
  },
  {
    id: 'F032',
    title: '2019 Duplex Ultrasound - TOS Positive',
    date: '13 June 2019',
    specialist: 'Vascular Sonographer',
    organisation: 'Royal Free Hospital',
    quote: '"Marked haemodynamic changes... a positive result."',
    summary: 'Complete cessation of flow within the distal subclavian artery during Adson\'s and EAST manoeuvres bilaterally.',
    legalSignificance: 'High-tier objective evidence that vascular compression existed years before later disputes. Undermines any "no objective evidence / purely functional" framing.',
    tier: 'Imaging' as const
  },
  {
    id: 'F033',
    title: '2024 UCLH MR - Dynamic Subclavian Compression',
    date: '10 January 2024',
    specialist: 'Dr An Thanh Ngo',
    organisation: 'UCLH',
    quote: 'Compression of the left subclavian artery and vein in the subclavicular space with arms abducted',
    summary: 'MR thoracic inlet/outlet report describes compression including apparent focal stenosis.',
    legalSignificance: 'High-tier imaging evidence. Reinforces long-running TOS reality. Rebuts "functional / non-organic" framing.',
    tier: 'Imaging' as const
  },
  {
    id: 'F036',
    title: 'US Doppler - Bilateral Subclavian Occlusion',
    date: '9 June 2025',
    specialist: 'Vascular Team',
    organisation: 'Royal Free Hospital',
    quote: 'At 90Â° abduction, subclavian veins "compressed with no flow"',
    summary: 'Dynamic vascular compression demonstrated with positional occlusion. Both arms show flow cessation in provocative positions.',
    legalSignificance: 'Establishes SIX-YEAR timeline of documented vascular pathology when combined with 2019 Doppler.',
    tier: 'Imaging' as const,
    featured: true
  },
  {
    id: 'F037',
    title: 'CT Aorta - TOS Not Excluded',
    date: '16 April 2024',
    specialist: 'Consultant Radiologist',
    organisation: 'UCLH',
    quote: '"A thoracic outlet syndrome affecting left subclavian artery cannot be excluded"',
    summary: 'Arms-down study shows no stenosis but radiologist explicitly states TOS cannot be excluded without dynamic study.',
    legalSignificance: 'Radiologist acknowledging static imaging does not negate condition. Recommended duplex was subsequently performed.',
    tier: 'Imaging' as const
  },
  {
    id: 'F034',
    title: 'Dr Gorrie Recognises 2021 Seizure/Fractures',
    date: '17 October 2023',
    specialist: 'Dr Alexander Gorrie',
    organisation: 'Current Practice',
    quote: 'History of tonic-clonic seizure in 2021 with rib injury... pain was not investigated properly',
    summary: 'First GP to properly recognise and act on injury pattern - what previous GPs dismissed for nearly 2 years.',
    legalSignificance: 'Shows concrete escalation step by new GP. Demonstrates persistence of symptoms and continuing need for assessment.',
    tier: 'Clinical' as const
  },
  {
    id: 'F354',
    title: 'Formal Epilepsy Diagnosis Confirmed',
    date: 'December 2024',
    specialist: 'Neurology Team',
    organisation: 'Imperial College Healthcare',
    quote: 'Epilepsy formally diagnosed',
    summary: 'Formal diagnosis validates all prior seizure events as genuine neurological episodes.',
    legalSignificance: 'Validates entire seizure history. Contradicts any suggestion of NEAD or functional episodes.',
    tier: 'Clinical' as const
  }
];

const featuredFindings = vindicationFindings.filter(f => f.featured);
const imagingFindings = vindicationFindings.filter(f => f.tier === 'Imaging');
const clinicalFindings = vindicationFindings.filter(f => f.tier === 'Clinical');

// Stats
const stats = {
  totalFindings: 22,
  imagingStudies: 6,
  specialists: 10,
  yearsOfEvidence: 6
};

// Timeline milestones for the journey
// Types: 'negative' (red), 'neutral' (amber), 'positive' (green)
const timelineMilestones = [
  {
    date: '2019',
    title: 'First Positive Imaging',
    description: 'Duplex ultrasound shows vascular compression',
    type: 'positive' as const,
    findingRef: 'F032'
  },
  {
    date: '2021',
    title: 'Seizure Event',
    description: 'Tonic-clonic seizure with rib fractures',
    type: 'neutral' as const
  },
  {
    date: '2023',
    title: 'Pain Clinic Refutes',
    description: 'C&W Pain Clinic disagrees with somatoform',
    type: 'positive' as const,
    findingRef: 'F031'
  },
  {
    date: '2023',
    title: 'Psychiatric Clearance',
    description: 'Dr Gupta finds no psychiatric disorders',
    type: 'positive' as const,
    findingRef: 'F038'
  },
  {
    date: '2024',
    title: 'MR Confirms TOS',
    description: 'UCLH imaging shows subclavian compression',
    type: 'positive' as const,
    findingRef: 'F033'
  },
  {
    date: '2024',
    title: 'Epilepsy Diagnosed',
    description: 'Formal neurological diagnosis',
    type: 'positive' as const,
    findingRef: 'F354'
  },
  {
    date: '2025',
    title: 'Somatoform Removed',
    description: 'Dr Gorrie marks diagnosis as INACTIVE',
    type: 'positive' as const,
    findingRef: 'F030'
  }
];
---

<BaseLayout title="Vindication" description="22+ independent specialist findings that vindicate the patient's presentation">
  <!-- Hero Section -->
  <section class="relative py-24 overflow-hidden">
    <!-- Background Effects -->
    <div class="absolute inset-0 bg-gradient-to-br from-navy-950 via-navy-900 to-navy-950"></div>
    <div class="absolute inset-0 bg-[radial-gradient(ellipse_at_top_right,_var(--tw-gradient-stops))] from-green-500/10 via-transparent to-transparent"></div>
    <div class="absolute bottom-0 left-0 w-[600px] h-[600px] bg-green-500/5 rounded-full blur-3xl -translate-x-1/2 translate-y-1/2"></div>
    <div class="absolute top-0 right-0 w-[400px] h-[400px] bg-gold-500/5 rounded-full blur-3xl translate-x-1/2 -translate-y-1/2"></div>

    <!-- Floating Particles -->
    <div class="absolute inset-0 overflow-hidden pointer-events-none">
      <div class="particle particle-1"></div>
      <div class="particle particle-2"></div>
      <div class="particle particle-3"></div>
    </div>

    <div class="container-wide relative z-10">
      <div class="max-w-4xl mx-auto text-center">
        <!-- Badge -->
        <div class="inline-flex items-center gap-2 px-4 py-2 rounded-full bg-green-500/10 border border-green-500/20 mb-8">
          <div class="w-2 h-2 rounded-full bg-green-500 animate-pulse"></div>
          <span class="text-sm font-medium text-green-400">Independent Clinical Evidence</span>
        </div>

        <!-- Title -->
        <h1 class="text-5xl sm:text-6xl lg:text-7xl font-display font-bold text-white mb-6 leading-tight">
          The Defence
          <span class="block text-transparent bg-clip-text bg-gradient-to-r from-green-400 via-gold-400 to-green-400">
            Cannot Argue
          </span>
        </h1>

        <!-- Subtitle -->
        <p class="text-xl text-navy-300 leading-relaxed mb-12 max-w-2xl mx-auto">
          Over <strong class="text-green-400">22 independent specialist findings</strong> that refute
          the psychiatric dismissal narrative and demonstrate clear organic pathology.
          Each vindication comes from NHS clinicians with no stake in this case.
        </p>

        <!-- Animated Stats -->
        <div class="grid grid-cols-2 lg:grid-cols-4 gap-6 max-w-3xl mx-auto">
          <div class="glass-card p-6 text-center">
            <div class="text-4xl font-display font-bold text-green-400 mb-2">
              <AnimatedCounter client:load end={stats.totalFindings} suffix="+" />
            </div>
            <p class="text-sm text-navy-400">Vindication Findings</p>
          </div>
          <div class="glass-card p-6 text-center">
            <div class="text-4xl font-display font-bold text-blue-400 mb-2">
              <AnimatedCounter client:load end={stats.imagingStudies} suffix="+" />
            </div>
            <p class="text-sm text-navy-400">Imaging Studies</p>
          </div>
          <div class="glass-card p-6 text-center">
            <div class="text-4xl font-display font-bold text-gold-400 mb-2">
              <AnimatedCounter client:load end={stats.specialists} suffix="+" />
            </div>
            <p class="text-sm text-navy-400">Specialists</p>
          </div>
          <div class="glass-card p-6 text-center">
            <div class="text-4xl font-display font-bold text-purple-400 mb-2">
              <AnimatedCounter client:load end={stats.yearsOfEvidence} />
            </div>
            <p class="text-sm text-navy-400">Years of Evidence</p>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Vindication Journey Timeline -->
  <section class="py-16 bg-navy-900/30">
    <div class="container-wide">
      <div class="text-center mb-12">
        <h2 class="text-3xl font-display font-bold text-white mb-4">The Vindication Journey</h2>
        <p class="text-navy-400 max-w-2xl mx-auto">
          From first positive imaging to formal vindication - a timeline of independent specialist findings
        </p>
      </div>

      <VindicationTimeline milestones={timelineMilestones} />
    </div>
  </section>

  <!-- Key Vindications - Featured Quote Wall -->
  <section class="py-20">
    <div class="container-wide">
      <div class="flex items-end justify-between mb-12">
        <div>
          <Badge variant="vindication" class="mb-4">Key Evidence</Badge>
          <h2 class="text-3xl font-display font-bold text-white">
            Landmark Vindication Findings
          </h2>
          <p class="text-navy-400 mt-2">The most significant independent clinical conclusions</p>
        </div>
      </div>

      <!-- Featured Quote Grid -->
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        {featuredFindings.map((finding) => (
          <VindicationQuote
            findingId={finding.id}
            title={finding.title}
            quote={finding.quote}
            specialist={finding.specialist}
            organisation={finding.organisation}
            date={finding.date}
            tier={finding.tier}
            summary={finding.summary}
            featured={true}
          />
        ))}
      </div>
    </div>
  </section>

  <!-- Evidence Tiers Section -->
  <section class="py-20 bg-navy-900/30">
    <div class="container-wide">
      <!-- Tier Filter Pills -->
      <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between gap-6 mb-12">
        <div>
          <h2 class="text-3xl font-display font-bold text-white mb-2">Complete Evidence Wall</h2>
          <p class="text-navy-400">Filter by evidence tier to explore the vindication findings</p>
        </div>
        <div class="flex flex-wrap gap-2" id="tier-filters">
          <button data-tier="ALL" class="tier-pill active px-4 py-2 rounded-full text-sm font-medium bg-gold-500 text-navy-900 transition-all">
            All Evidence
          </button>
          <button data-tier="Imaging" class="tier-pill px-4 py-2 rounded-full text-sm font-medium bg-blue-500/10 text-blue-400 hover:bg-blue-500/20 transition-all">
            <svg class="w-4 h-4 inline mr-1.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
            </svg>
            Imaging ({imagingFindings.length})
          </button>
          <button data-tier="Clinical" class="tier-pill px-4 py-2 rounded-full text-sm font-medium bg-green-500/10 text-green-400 hover:bg-green-500/20 transition-all">
            <svg class="w-4 h-4 inline mr-1.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z" />
            </svg>
            Clinical ({clinicalFindings.length})
          </button>
        </div>
      </div>

      <!-- Quote Wall Grid -->
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="quote-wall">
        {vindicationFindings.map((finding, index) => (
          <div
            class="quote-card"
            data-tier={finding.tier}
            style={`animation-delay: ${index * 0.1}s`}
          >
            <VindicationQuote
              findingId={finding.id}
              title={finding.title}
              quote={finding.quote}
              specialist={finding.specialist}
              organisation={finding.organisation}
              date={finding.date}
              tier={finding.tier}
              summary={finding.summary}
              featured={finding.featured}
            />
          </div>
        ))}
      </div>
    </div>
  </section>

  <!-- Summary CTA Section -->
  <section class="py-20">
    <div class="container-wide">
      <GlassCard variant="vindication" class="p-12 text-center relative overflow-hidden">
        <!-- Decorative Elements -->
        <div class="absolute top-0 left-0 w-64 h-64 bg-green-500/10 rounded-full blur-3xl -translate-x-1/2 -translate-y-1/2"></div>
        <div class="absolute bottom-0 right-0 w-64 h-64 bg-gold-500/10 rounded-full blur-3xl translate-x-1/2 translate-y-1/2"></div>

        <div class="relative z-10 max-w-3xl mx-auto">
          <!-- Icon -->
          <div class="w-20 h-20 mx-auto mb-8 rounded-2xl bg-gradient-to-br from-green-500/20 to-green-600/20 flex items-center justify-center border border-green-500/30">
            <svg class="w-10 h-10 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z" />
            </svg>
          </div>

          <h2 class="text-4xl font-display font-bold text-white mb-6">
            Independent Clinical Vindication
          </h2>

          <p class="text-lg text-navy-300 mb-8 leading-relaxed">
            Every vindication finding comes from NHS clinicians with no prior involvement in the case.
            They independently examined the patient, reviewed the evidence, and reached conclusions
            that <strong class="text-green-400">contradict the psychiatric dismissal narrative</strong> applied by the former GP practice.
          </p>

          <div class="flex flex-wrap justify-center gap-4">
            <a
              href={getHref('/findings')}
              class="inline-flex items-center gap-2 px-6 py-3 bg-green-500 hover:bg-green-600 text-white font-semibold rounded-xl transition-all shadow-lg shadow-green-500/25 hover:shadow-green-500/40"
            >
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
              </svg>
              View All Findings
            </a>
            <a
              href={getHref('/timeline')}
              class="inline-flex items-center gap-2 px-6 py-3 bg-navy-700/50 hover:bg-navy-700 text-white font-semibold rounded-xl border border-navy-600/50 transition-all"
            >
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
              </svg>
              See Full Timeline
            </a>
          </div>
        </div>
      </GlassCard>
    </div>
  </section>
</BaseLayout>

<style>
  /* Floating particles animation */
  .particle {
    position: absolute;
    width: 4px;
    height: 4px;
    background: rgba(34, 197, 94, 0.3);
    border-radius: 50%;
    animation: float 20s infinite ease-in-out;
  }

  .particle-1 {
    top: 20%;
    left: 10%;
    animation-delay: 0s;
  }

  .particle-2 {
    top: 60%;
    left: 80%;
    animation-delay: -7s;
    width: 6px;
    height: 6px;
  }

  .particle-3 {
    top: 40%;
    left: 50%;
    animation-delay: -14s;
    width: 3px;
    height: 3px;
  }

  @keyframes float {
    0%, 100% {
      transform: translate(0, 0) rotate(0deg);
      opacity: 0.3;
    }
    25% {
      transform: translate(50px, -50px) rotate(90deg);
      opacity: 0.6;
    }
    50% {
      transform: translate(100px, 0) rotate(180deg);
      opacity: 0.3;
    }
    75% {
      transform: translate(50px, 50px) rotate(270deg);
      opacity: 0.6;
    }
  }

  /* Tier filter pill states */
  .tier-pill.active {
    @apply bg-gold-500 text-navy-900;
  }

  .tier-pill:not(.active):hover {
    transform: translateY(-1px);
  }

  /* Quote card staggered animation */
  .quote-card {
    opacity: 0;
    animation: quote-fade-in 0.6s ease-out forwards;
  }

  @keyframes quote-fade-in {
    from {
      opacity: 0;
      transform: translateY(20px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  /* Glass card styling */
  .glass-card {
    @apply bg-navy-800/40 backdrop-blur-xl border border-navy-700/50 rounded-2xl;
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const tierPills = document.querySelectorAll('.tier-pill');
    const quoteCards = document.querySelectorAll('.quote-card');

    tierPills.forEach((pill) => {
      pill.addEventListener('click', () => {
        const tier = (pill as HTMLElement).dataset.tier;

        // Update active state
        tierPills.forEach((p) => {
          p.classList.remove('active', 'bg-gold-500', 'text-navy-900');
          if (p !== pill) {
            // Reset to original tier colors
            const pillTier = (p as HTMLElement).dataset.tier;
            if (pillTier === 'ALL') {
              p.classList.add('bg-navy-700/50', 'text-navy-400');
            }
          }
        });
        pill.classList.add('active', 'bg-gold-500', 'text-navy-900');
        pill.classList.remove('bg-navy-700/50', 'text-navy-400', 'bg-blue-500/10', 'text-blue-400', 'bg-green-500/10', 'text-green-400');

        // Filter cards
        quoteCards.forEach((card, index) => {
          const cardTier = (card as HTMLElement).dataset.tier;
          if (tier === 'ALL' || cardTier === tier) {
            (card as HTMLElement).style.display = '';
            (card as HTMLElement).style.animationDelay = `${index * 0.05}s`;
          } else {
            (card as HTMLElement).style.display = 'none';
          }
        });
      });
    });
  });
</script>
