---
/**
 * Documents Page - V2 Design
 *
 * Document vault showcase with:
 * - Dramatic hero with document stats
 * - Evidence tier quick reference
 * - Category-based vault sections
 * - Tier filtering functionality
 * - Premium glassmorphism design
 */

import BaseLayout from '@layouts/BaseLayout.astro';
import GlassCard from '@components/ui/GlassCard.astro';
import Badge from '@components/common/Badge.astro';
import DocumentVault from '@components/documents/DocumentVault.astro';

const base = import.meta.env.BASE_URL;
const getHref = (path: string) => path === '/' ? (base || '/') : `${base}${path}`;

// Document categories with full data
const documentCategories = [
  {
    name: 'Imaging Reports',
    slug: 'imaging',
    icon: 'M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z',
    color: 'gold' as const,
    description: 'Objective diagnostic imaging - highest reliability evidence',
    documents: [
      { name: 'MRI T5-T8 Fractures', date: 'Nov 2022', significance: 'Documents vertebral fractures 11 months after seizure', tier: 1 },
      { name: 'Duplex Ultrasound TOS', date: 'Jun 2019', significance: 'First objective TOS-positive finding', tier: 1 },
      { name: 'UCLH MR Thoracic Inlet/Outlet', date: 'Jan 2024', significance: 'Dynamic subclavian compression demonstrated', tier: 1 },
      { name: 'CT Aorta with Contrast', date: 'Apr 2024', significance: 'Radiologist notes TOS cannot be excluded', tier: 1 },
      { name: 'US Doppler Upper Limb Veins', date: 'Jun 2025', significance: 'Bilateral subclavian occlusion in abduction', tier: 1 }
    ]
  },
  {
    name: 'Specialist Letters',
    slug: 'specialist',
    icon: 'M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z',
    color: 'vindication' as const,
    description: 'Independent specialist assessments and clinical letters',
    documents: [
      { name: 'Dr Gupta Psychiatric Assessment', date: '2023', significance: 'Formal clearance - no psychiatric disorders found', tier: 2 },
      { name: 'Pain Clinic Somatoform Refutation', date: '2023', significance: '"felt not somatic" - specialist disagreement', tier: 2 },
      { name: 'Dr Karunaratne Neurology Letter', date: 'Mar 2022', significance: 'Epilepsy pathway documentation', tier: 2 },
      { name: 'UCLH Hypermobility Service', date: 'Jul 2021', significance: 'Physical examination findings documented', tier: 2 },
      { name: 'Sumeer Bhamm MSK Letter', date: 'Nov 2021', significance: 'Documents Pain Clinic rejection without consultation', tier: 5 }
    ]
  },
  {
    name: 'Emergency Records',
    slug: 'emergency',
    icon: 'M13 10V3L4 14h7v7l9-11h-7z',
    color: 'causation' as const,
    description: 'Ambulance service and emergency department records',
    documents: [
      { name: 'LAS ePCR - First Seizure', date: '23 Dec 2021', significance: 'Hardcoded timestamps, 5-min response, HR 133', tier: 3 },
      { name: 'ED Discharge Summary', date: '24 Dec 2021', significance: '"Soft tissue injury" - inadequate diagnosis', tier: 3 },
      { name: 'ED Summary - Second Seizure', date: '18 Feb 2022', significance: 'Epilepsy diagnosis, "first seizure on 23/12"', tier: 3 }
    ]
  },
  {
    name: 'GP Records',
    slug: 'gp',
    icon: 'M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2',
    color: 'breach' as const,
    description: 'GP consultation entries - lowest reliability, requires verification',
    documents: [
      { name: 'MH1 Referral - Somatisation Framing', date: 'Sep 2020', significance: 'Links symptoms to brother\'s death', tier: 7 },
      { name: '"Sleeping Pain-Free" Entry', date: 'Sep 2021', significance: 'CONTRADICTED by MSK physio notes', tier: 7 },
      { name: 'F45.4 Somatoform Coding', date: 'Jan 2023', significance: 'Covert psychiatric diagnosis without assessment', tier: 7 },
      { name: 'Somatoform Removal Entry', date: 'Jul 2025', significance: '"clear causes for his pain"', tier: 7 }
    ]
  },
  {
    name: 'Witness Evidence',
    slug: 'witness',
    icon: 'M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z',
    color: 'default' as const,
    description: 'Third-party corroboration and witness statements',
    documents: [
      { name: 'iMessage Evidence - Clive Polles', date: '2021-2026', significance: '50+ messages documenting care failures', tier: 3 },
      { name: 'MSK Physio "Attention Seeking" Note', date: 'Aug 2021', significance: 'Third-party documentation of GP dismissal', tier: 5 },
      { name: 'Parent Witness Statements', date: 'Pending', significance: '"Data manipulation" statement witnesses', tier: 3 }
    ]
  }
];

// Calculate stats
const totalDocuments = documentCategories.reduce((sum, cat) => sum + cat.documents.length, 0);
const tier1Count = documentCategories.reduce((sum, cat) => sum + cat.documents.filter(d => d.tier === 1).length, 0);
const tier7Count = documentCategories.reduce((sum, cat) => sum + cat.documents.filter(d => d.tier === 7).length, 0);

// Evidence tier quick reference
const tierReference = [
  { tier: 1, label: 'Highest', description: 'Objective imaging (MRI, CT, ultrasound)', color: 'gold' },
  { tier: 2, label: 'High', description: 'Independent specialist letters', color: 'green' },
  { tier: 3, label: 'High', description: 'Ambulance/A&E records', color: 'purple' },
  { tier: 4, label: 'Med-High', description: 'Pharmacy records', color: 'blue' },
  { tier: 5, label: 'Medium', description: 'Independent clinician notes', color: 'cyan' },
  { tier: 6, label: 'Medium', description: 'GP referral responses', color: 'amber' },
  { tier: 7, label: 'Lowest', description: 'GP consultation entries', color: 'red' }
];

// Color map for tier reference cards
const tierColorMap: Record<string, { bg: string; text: string; border: string }> = {
  gold: { bg: 'bg-gold-500/10', text: 'text-gold-400', border: 'border-gold-500/30' },
  green: { bg: 'bg-green-500/10', text: 'text-green-400', border: 'border-green-500/30' },
  purple: { bg: 'bg-purple-500/10', text: 'text-purple-400', border: 'border-purple-500/30' },
  blue: { bg: 'bg-blue-500/10', text: 'text-blue-400', border: 'border-blue-500/30' },
  cyan: { bg: 'bg-cyan-500/10', text: 'text-cyan-400', border: 'border-cyan-500/30' },
  amber: { bg: 'bg-amber-500/10', text: 'text-amber-400', border: 'border-amber-500/30' },
  red: { bg: 'bg-red-500/10', text: 'text-red-400', border: 'border-red-500/30' }
};

// Tier filter button colors
const tierFilterColors: Record<number, string> = {
  1: 'bg-gold-500/20 text-gold-400 hover:bg-gold-500 hover:text-navy-900',
  2: 'bg-green-500/20 text-green-400 hover:bg-green-500 hover:text-white',
  3: 'bg-purple-500/20 text-purple-400 hover:bg-purple-500 hover:text-white',
  4: 'bg-blue-500/20 text-blue-400 hover:bg-blue-500 hover:text-white',
  5: 'bg-cyan-500/20 text-cyan-400 hover:bg-cyan-500 hover:text-white',
  6: 'bg-amber-500/20 text-amber-400 hover:bg-amber-500 hover:text-white',
  7: 'bg-red-500/20 text-red-400 hover:bg-red-500 hover:text-white'
};
---

<BaseLayout title="Document Vault" description="Key evidence documents organised by category and reliability tier">
  <!-- Hero Section -->
  <section class="relative py-24 overflow-hidden">
    <!-- Background Effects -->
    <div class="absolute inset-0 bg-gradient-to-br from-navy-950 via-navy-900 to-navy-950"></div>
    <div class="absolute inset-0 bg-[radial-gradient(ellipse_at_top_right,_var(--tw-gradient-stops))] from-gold-500/10 via-transparent to-transparent"></div>
    <div class="absolute bottom-0 left-0 w-[500px] h-[500px] bg-purple-500/5 rounded-full blur-3xl -translate-x-1/2 translate-y-1/2"></div>

    <!-- Decorative Folder Icon -->
    <div class="absolute top-20 right-20 w-32 h-32 text-navy-800/30 hidden lg:block">
      <svg fill="currentColor" viewBox="0 0 24 24">
        <path d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z" />
      </svg>
    </div>

    <div class="container-wide relative z-10">
      <div class="max-w-4xl mx-auto text-center">
        <!-- Badge -->
        <div class="inline-flex items-center gap-2 px-4 py-2 rounded-full bg-gold-500/10 border border-gold-500/20 mb-8">
          <svg class="w-4 h-4 text-gold-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4" />
          </svg>
          <span class="text-sm font-medium text-gold-400">Evidence Repository</span>
        </div>

        <!-- Title -->
        <h1 class="text-5xl sm:text-6xl font-display font-bold text-white mb-6 leading-tight">
          Document
          <span class="block text-transparent bg-clip-text bg-gradient-to-r from-gold-400 via-amber-400 to-gold-400">
            Vault
          </span>
        </h1>

        <!-- Subtitle -->
        <p class="text-xl text-navy-300 leading-relaxed mb-12 max-w-2xl mx-auto">
          Primary evidence documents organised by category. Each document is assigned an evidence tier based on reliability and independence from disputed sources.
        </p>

        <!-- Stats Row -->
        <div class="grid grid-cols-2 lg:grid-cols-4 gap-4 max-w-3xl mx-auto">
          <GlassCard class="p-5 text-center">
            <div class="text-3xl font-display font-bold text-gold-400 mb-1">{totalDocuments}</div>
            <p class="text-xs text-navy-400">Total Documents</p>
          </GlassCard>
          <GlassCard class="p-5 text-center">
            <div class="text-3xl font-display font-bold text-green-400 mb-1">{documentCategories.length}</div>
            <p class="text-xs text-navy-400">Categories</p>
          </GlassCard>
          <GlassCard class="p-5 text-center">
            <div class="text-3xl font-display font-bold text-purple-400 mb-1">{tier1Count}</div>
            <p class="text-xs text-navy-400">Tier 1 (Highest)</p>
          </GlassCard>
          <GlassCard class="p-5 text-center">
            <div class="text-3xl font-display font-bold text-red-400 mb-1">{tier7Count}</div>
            <p class="text-xs text-navy-400">Tier 7 (GP Entries)</p>
          </GlassCard>
        </div>
      </div>
    </div>
  </section>

  <!-- Evidence Tier Reference -->
  <section class="py-16 bg-navy-900/30">
    <div class="container-wide">
      <div class="flex items-end justify-between mb-10">
        <div>
          <Badge variant="strategic" class="mb-4">Reference Guide</Badge>
          <h2 class="text-3xl font-display font-bold text-white">
            Evidence Reliability Tiers
          </h2>
          <p class="text-navy-400 mt-2">Understanding document reliability hierarchy</p>
        </div>
        <a
          href={getHref('/evidence')}
          class="hidden sm:inline-flex items-center gap-2 text-sm text-gold-400 hover:text-gold-300 transition-colors"
        >
          <span>Full methodology</span>
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3" />
          </svg>
        </a>
      </div>

      <div class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-7 gap-3">
        {tierReference.map((tier, index) => {
          const style = tierColorMap[tier.color];
          return (
            <div
              class:list={[
                'p-4 rounded-xl border backdrop-blur-sm transition-all hover:scale-105',
                style.bg,
                style.border
              ]}
              style={`animation-delay: ${index * 50}ms`}
            >
              <div class="flex items-center gap-2 mb-2">
                <span class:list={['text-2xl font-display font-bold', style.text]}>
                  {tier.tier}
                </span>
                <span class:list={['text-xs px-1.5 py-0.5 rounded', style.bg, style.text]}>
                  {tier.label}
                </span>
              </div>
              <p class="text-xs text-navy-400 leading-relaxed">
                {tier.description}
              </p>
            </div>
          );
        })}
      </div>
    </div>
  </section>

  <!-- Tier Filter Bar -->
  <div class="sticky top-16 z-30 -mx-4 px-4 sm:-mx-6 sm:px-6 lg:-mx-8 lg:px-8 py-4 bg-navy-900/80 backdrop-blur-2xl border-b border-navy-700/50">
    <div class="flex items-center justify-between gap-4">
      <div class="flex items-center gap-3 overflow-x-auto pb-1">
        <span class="text-sm text-navy-500 whitespace-nowrap">Filter by tier:</span>
        <div class="flex gap-2" id="tier-filters">
          <button
            data-tier="all"
            class="tier-btn active px-3 py-1.5 rounded-full text-xs font-medium bg-gold-500 text-navy-900 transition-all hover:scale-105"
          >
            All
          </button>
          {[1, 2, 3, 4, 5, 6, 7].map(tier => (
            <button
              data-tier={tier}
              class:list={[
                'tier-btn px-3 py-1.5 rounded-full text-xs font-medium transition-all hover:scale-105',
                tierFilterColors[tier]
              ]}
            >
              Tier {tier}
            </button>
          ))}
        </div>
      </div>

      <div class="hidden sm:flex items-center gap-2 text-xs text-navy-500">
        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
        </svg>
        <span>Click category to expand</span>
      </div>
    </div>
  </div>

  <!-- Document Vault -->
  <section class="py-16">
    <div class="container-wide">
      <div class="flex items-end justify-between mb-10">
        <div>
          <Badge variant="vindication" class="mb-4">Evidence Archive</Badge>
          <h2 class="text-3xl font-display font-bold text-white">
            Document Categories
          </h2>
          <p class="text-navy-400 mt-2">Click to expand each category</p>
        </div>
        <div class="hidden sm:block text-sm text-navy-500">
          {documentCategories.length} categories â€¢ {totalDocuments} documents
        </div>
      </div>

      <DocumentVault
        categories={documentCategories}
        defaultExpanded={['imaging']}
      />
    </div>
  </section>

  <!-- Document Access CTA -->
  <section class="py-16">
    <div class="container-wide">
      <GlassCard variant="highlight" class="p-10 text-center relative overflow-hidden">
        <!-- Decorative -->
        <div class="absolute top-0 right-0 w-64 h-64 bg-gold-500/5 rounded-full blur-3xl translate-x-1/2 -translate-y-1/2"></div>

        <div class="relative z-10 max-w-2xl mx-auto">
          <h2 class="text-3xl font-display font-bold text-white mb-4">
            Document Access
          </h2>
          <p class="text-navy-300 mb-8">
            Full document copies are available in the evidence repository for legal review. All documents are preserved in their original format with metadata intact. For the complete evidence methodology, see the Evidence page.
          </p>
          <div class="flex flex-wrap justify-center gap-4">
            <a
              href={getHref('/evidence')}
              class="inline-flex items-center gap-2 px-6 py-3 bg-gold-500 hover:bg-gold-600 text-navy-900 font-semibold rounded-xl transition-all shadow-lg shadow-gold-500/25"
            >
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4" />
              </svg>
              View Evidence Methodology
            </a>
            <a
              href={getHref('/findings')}
              class="inline-flex items-center gap-2 px-6 py-3 bg-navy-700/50 hover:bg-navy-700 text-white font-semibold rounded-xl border border-navy-600/50 transition-all"
            >
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
              </svg>
              View Findings
            </a>
          </div>
        </div>
      </GlassCard>
    </div>
  </section>
</BaseLayout>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const tierButtons = document.querySelectorAll('.tier-btn');
    const documentCards = document.querySelectorAll('.document-card');

    let activeTier = 'all';

    tierButtons.forEach(btn => {
      btn.addEventListener('click', () => {
        const tier = (btn as HTMLElement).dataset.tier || 'all';
        activeTier = tier;

        // Update button styles
        tierButtons.forEach(b => {
          b.classList.remove('active');
          if ((b as HTMLElement).dataset.tier === 'all') {
            if (tier === 'all') {
              b.classList.add('bg-gold-500', 'text-navy-900');
              b.classList.remove('bg-gold-500/20', 'text-gold-400');
            } else {
              b.classList.remove('bg-gold-500', 'text-navy-900');
              b.classList.add('bg-gold-500/20', 'text-gold-400');
            }
          }
        });

        if (tier !== 'all') {
          btn.classList.add('active');
        }

        // Filter document cards
        documentCards.forEach(card => {
          const cardElement = card as HTMLElement;
          const cardTier = cardElement.querySelector('[class*="rounded-lg"][class*="font-display"]')?.textContent?.trim();

          if (tier === 'all' || cardTier === tier) {
            cardElement.style.display = '';
          } else {
            cardElement.style.display = 'none';
          }
        });
      });
    });
  });
</script>
